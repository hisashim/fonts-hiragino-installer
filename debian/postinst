#!/bin/sh
# postinst script for otf-hiragino-installer
#
# see: dh_installdeb(1)

set -e

# summary of how this script can be called:
#        * <postinst> `configure' <most-recently-configured-version>
#        * <old-postinst> `abort-upgrade' <new version>
#        * <conflictor's-postinst> `abort-remove' `in-favour' <package>
#          <new-version>
#        * <postinst> `abort-remove'
#        * <deconfigured's-postinst> `abort-deconfigure' `in-favour'
#          <failed-install-package> <version> `removing'
#          <conflicting-package> <version>
# for details, see http://www.debian.org/doc/debian-policy/ or
# the debian-policy package

DESTDIR=${DESTDIR:-}
FONTSDIR=${FONTSDIR:-${DESTDIR}/usr/share/fonts}
TEXMF=${TEXMF:-${DESTDIR}/usr/share/texmf}
TEXMF_TL=${TEXMF_TL:-${DESTDIR}/usr/share/texmf-texlive}
SRCDIR=${SRCDIR:-/var/tmp/hiragino}

hiraminstd=`for v in Std StdN; do for w in 2 3 4 5 6 7 8; do
  echo HiraMin${v}-W${w}.otf;
done done`
hiraminpro=`for v in Pro ProN; do for w in 2 3 6; do
  echo HiraMin${v}-W${w}.otf;
done done`
hirakakustd=`for v in Std StdN; do for w in 1 2 3 4 5 6 7 8 9; do
  echo HiraKaku${v}-W${w}.otf;
done done`
hirakakupro=`for v in Pro ProN; do for w in 3 6; do
  echo HiraKaku${v}-W${w}.otf;
done done`
hiramarustd=`for v in Std StdN; do for w in 2 4 6 8; do
  echo HiraMaru${v}-W${w}.otf;
done done`
hiramarupro=`for v in Pro ProN; do for w in 4; do
  echo HiraMaru${v}-W${w}.otf;
done done`
hiragyostd=`for v in Std StdN; do for w in 4 8; do
  echo HiraGyo${v}-W${w}.otf;
done done`
hiragyopro=
hiraall="${hiraminstd} ${hiraminpro} ${hirakakustd} ${hirakakupro}
         ${hiramarustd} ${hiramarupro} ${hiragyostd} ${hiragyopro}"
found=`for f in ${hiraall}; do
  if [ -f ${SRCDIR}/${f} ]; then echo "${f}"; fi;
done`
notfound=`for f in ${hiraall}; do
  if [ ! -f ${SRCDIR}/${f} ]; then echo "${f}"; fi;
done`

case "$1" in
    configure)
        if [ ! -d ${FONTSDIR}/opentype/hiragino ]; then
          echo "Creating directory ${FONTSDIR}/opentype/hiragino"
          mkdir -p ${FONTSDIR}/opentype/hiragino
        fi
        cp `for f in ${found}; do echo ${SRCDIR}/${f}; done` \
             ${FONTSDIR}/opentype/hiragino/
	chmod 644 ${FONTSDIR}/opentype/hiragino/*
        for d in ${TEXMF}/fonts ${TEXMF_TL}/fonts; do
          echo "Looking for directory ${d}"
          if [ -d ${d} ]; then
            echo "${d} found"
            if [ ! -d ${d}/opentype ]; then
              echo "Creating directory ${d}/opentype"
              mkdir -p ${d}/opentype
            fi
            if [ ! -h ${d}/opentype/hiragino ]; then
              echo -n "Creating symlink from ${d}/opentype/hiragino"
              echo    " to ${FONTSDIR}/opentype/hiragino"
              ln -s ${FONTSDIR}/opentype/hiragino ${d}/opentype/hiragino
            fi
          fi
        done
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
